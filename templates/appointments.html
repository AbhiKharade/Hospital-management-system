{% extends "base.html" %}
{% block title %}Appointments — Hospital{% endblock %}
{% block content %}
<h2>Appointments</h2>
<p class="text-muted">Upcoming appointments (read-only). Use Admin to add or manage.</p>

<div id="apps" class="mt-3">
  <div class="spinner-border text-primary" role="status" id="loading-apps">
    <span class="visually-hidden">Loading...</span>
  </div>
  <ul class="list-group d-none" id="list-apps"></ul>
  <div class="mt-3" id="empty-apps" style="display:none">No appointments found.</div>
</div>

<script>
async function loadApps() {
  const list = document.getElementById('list-apps');
  const loading = document.getElementById('loading-apps');
  const empty = document.getElementById('empty-apps');
  try {
    const res = await fetch('/api/appointments');
    const data = await res.json();
    loading.classList.add('d-none');
    if (!data || data.length === 0) {
      empty.style.display = 'block';
      return;
    }
    list.classList.remove('d-none');
    data.forEach(a => {
      const li = document.createElement('li');
      li.className = 'list-group-item';
      li.innerHTML = `<strong>Appointment #${a.id}</strong>
        <div class="small">Patient: ${a.patient_id} • Doctor: ${a.doctor_id} • When: ${new Date(a.scheduled_at).toLocaleString()}</div>
        <div class="mt-1">${a.notes ?? ''}</div>`;
      list.appendChild(li);
    });
  } catch (e) {
    loading.classList.add('d-none');
    empty.style.display = 'block';
    empty.textContent = 'Failed to load appointments.';
  }
}
loadApps();
</script>
{% endblock %}